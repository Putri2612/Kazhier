"use strict";const FormWizard={},DataTable=element=>{const lastIndex=element.querySelectorAll("thead th").length-1,lastColumnOption={select:lastIndex,sortable:!1};return new simpleDatatables.DataTable(element,{columns:[lastColumnOption]})},InitModal=content=>{let dialog=document.createElement("div");return dialog.className="modal fade",dialog.setAttribute("tabindex","-1"),dialog.innerHTML=`<div class="modal-dialog modal-dialog-centered">${content}</div>`,dialog},CreateModal=(url,data,callbacks={yes:()=>!0,no:()=>!1})=>{fetch(`${url}?${data}`,{method:"get"}).then(response=>{if(response.ok)return response.text();throw new Error(`${response.status}: ${response.statusText}`)}).then(data=>{let dialog=InitModal(data);document.body.append(dialog),dialog.querySelector(".dialog-yes").addEventListener("click",()=>{callbacks.yes(),$(dialog).modal("hide"),setTimeout(()=>dialog.parentNode.removeChild(dialog),2e3)}),dialog.querySelector(".dialog-no").addEventListener("click",()=>{callbacks.no(),$(dialog).modal("hide"),setTimeout(()=>dialog.parentNode.removeChild(dialog),2e3)}),$(dialog).modal("show")}).catch(error=>{toastrs("Error",error,"error"),console.error(error)})},EmptyInputModal=(items,form)=>{let parameters=[];items.forEach(item=>{parameters.push(`item[]=${item}`)}),parameters=parameters.join("&"),parameters=`${parameters}&title=Empty Inputs`;let url=window.location.href,pos=url.indexOf("/app/"),destination=url.substring(0,pos+5)+"dialog-empty-input";CreateModal(destination,parameters,{yes:()=>form.submit(),no:()=>!1})},ConfirmDeleteModal=target=>{let parameter=`url=${target}`,url=window.location.href,pos=url.indexOf("/app/"),destination=url.substring(0,pos+5)+"dialog-confirm-delete";CreateModal(destination,parameter,{yes:()=>document.querySelector("#confirm-delete-modal").submit(),no:()=>!1})},ConfirmStatusModal=(target,status)=>{let parameter=`url=${target}&status=${status}`,url=window.location.href,pos=url.indexOf("/app/"),destination=url.substring(0,pos+5)+"dialog-status-update";CreateModal(destination,parameter,{yes:()=>document.querySelector("#confirm-status-modal").submit(),no:()=>!1})},openNext=(prevSelector,nextSelector)=>{const prev=document.querySelector(prevSelector),next=document.querySelector(nextSelector);$(prev).fadeOut(500),$(next).delay(500).fadeIn(500)},CanNavigate=()=>{document.addEventListener("click",event=>{const target=event.target;!target.hasAttribute("can-navigate")||target.disabled||target.classList.contains("disabled")||openNext(target.getAttribute("data-navigate-from"),target.getAttribute("data-navigate-to"))})},toolTipsItem=[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')),toolTips=[];toolTipsItem.forEach(item=>{toolTips.push(new bootstrap.Tooltip(item,{boundary:document.body}))});const CheckEmptyInputs=form=>{const inputs=form.querySelectorAll("input, select, textarea");let emptyInputs=[];return inputs.forEach(input=>{input.value&&""!=input.value||!input.hasAttribute("data-is-required")||"hidden"==input.getAttribute("type")||emptyInputs.push(input.name)}),{result:Boolean(emptyInputs.length),items:emptyInputs}},ValidateForm=event=>{event.preventDefault();const form=event.target;if(!ValidateCurrencyInput(form))return!1;let isEmpty=CheckEmptyInputs(form);if(!isEmpty.result)return form.submit();EmptyInputModal(isEmpty.items,form)},dropzones={},ReadableToProcessable=input=>parseFloat(input.replace(/\./g,"").replace(/,/g,".")),ProcessableToReadable=input=>input.toFixed(2).toString().replace(/\./g,",").replace(/\B(?=(\d{3})+(?!\d))/g,"."),UpdateSubTotal=()=>{let inputs=document.querySelectorAll(".amount"),subTotal=0;inputs.forEach(input=>{subTotal=parseFloat(subTotal)+parseFloat(ReadableToProcessable(input.innerHTML))}),subTotal=ProcessableToReadable(subTotal),document.querySelector(".subTotal").innerHTML=subTotal,document.querySelector(".totalAmount").innerHTML=subTotal},UpdateInvoiceAndBillItemData=(target,additionalData=null)=>{let element=target;for(;!element.getAttribute("data-is-item");)element=element.parentNode;let quantity=ReadableToProcessable(element.querySelector(".quantity").value),price=ReadableToProcessable(element.querySelector(".price").value),tax=ReadableToProcessable(element.querySelector(".tax").value),discount=ReadableToProcessable(element.querySelector(".discount").value),totalPrice=quantity*price,taxPrice,amount=ProcessableToReadable(totalPrice+tax/100*totalPrice-discount);if(additionalData.products){const id=element.querySelector(".item").value,product=additionalData.products[id];quantity>product.stock&&(toastrs("Error","Not enough stock","error"),element.querySelector(".quantity").value=ProcessableToReadable(product.stock))}if(additionalData.discount.amount){const CustomerDiscount=additionalData.discount;if(CustomerDiscount.amount>1&&CustomerDiscount.amount>discount)discount=CustomerDiscount.amount;else if(CustomerDiscount.amount<=1){let tempDiscount=price*CustomerDiscount.amount;tempDiscount>CustomerDiscount.max&&CustomerDiscount.max>0&&(tempDiscount=CustomerDiscount.max),tempDiscount>discount&&(discount=tempDiscount)}element.querySelector(".discount").value=ProcessableToReadable(discount)}element.querySelector(".amount").innerHTML=amount,UpdateSubTotal()},OnlyAllowNumber=()=>{const events=["input","keydown","keyup","mousedown","mouseup","select","contextmenu","drop"];events.forEach(event=>{document.addEventListener(event,event=>{let target=event.target;if("INPUT"==target.nodeName&&target.hasAttribute("data-is-number")){let filtered;/^\-?[0-9\.]*\,?[0-9]*$/.test(target.value)?(target.oldValue=target.value,target.oldSelectionStart=target.selectionStart,target.oldSelectionEnd=target.selectionEnd):target.hasOwnProperty("oldValue")?(target.value=target.oldValue,target.setSelectionRange(target.oldSelectionStart,target.oldSelectionEnd)):target.value="",""==target.value||"-"==target.value||/^[0-9\.]*\,$/.test(target.value)||(target.value=AddNumberSeparator(target.value))}"INPUT"!=target.nodeName&&"SELECT"!=target.nodeName&&"TEXTAREA"!=target.nodeName||WatchChange(target,!0)})})};OnlyAllowNumber();const AddNumberSeparator=number=>parseFloat(number.replace(/\./g,"").replace(/,/g,".")).toLocaleString("id",{maximumFractionDigits:6}),ValidateCurrencyInput=form=>{const inputs=form.querySelectorAll("input[data-is-number]");let error=!1;return!inputs||(inputs.forEach(input=>{let pattern;/^\-?[0-9\.]*,?[0-9]*$/.test(input.value)||null===input.value||(error=!0)}),!error)||(toastrs("Error",'"Invalid number format."',"error"),!1)},WatchChange=(input,testOtherInput=!1)=>{if(input.value&&""!=input.value&&("SELECT"!=input.nodeName||"0"!=input.value)||!input.hasAttribute("data-is-required")&&!input.hasAttribute("required")?"SELECT"==input.nodeName&&input.classList.contains("selectric")?input.parentNode.parentNode.querySelector("div.selectric").classList.remove("is-invalid"):input.classList.remove("is-invalid"):"SELECT"==input.nodeName&&input.classList.contains("selectric")?input.parentNode.parentNode.querySelector("div.selectric").classList.add("is-invalid"):input.classList.add("is-invalid"),testOtherInput){let form=input.parentNode,isInput=!0;for(;"FORM"!=form.nodeName;){if("BODY"==form.nodeName){isInput=!1;break}form=form.parentNode}if(isInput){const inputs=form.querySelectorAll("input, select, textarea");inputs.forEach(item=>WatchChange(item))}}},CopyFromInput=(InputSelector,ButtonSelector)=>{const input=document.querySelector(InputSelector),btn=document.querySelector(ButtonSelector);btn.addEventListener("click",event=>{input.select(),input.setSelectionRange(0,99999),navigator.clipboard.writeText(input.value),toastrs("Copied","code copied","success")})},SelectricChangeCallbacks=[event=>{if(event.target.value.includes("new")){let url=window.location.href,pos=url.indexOf("/app/"),target=event.target.value.split(".")[1],destination=url.substring(0,pos+5)+target;window.location.href=destination}}],underlineDropdowns=document.querySelectorAll(".underline-dropdown");underlineDropdowns.length&&underlineDropdowns.forEach(element=>{element.addEventListener("click",event=>{"SELECT"==event.target.nodeName&&(event.currentTarget.hasAttribute("disable-update")||(event.currentTarget.classList.contains("is-active")?event.currentTarget.classList.remove("is-active"):event.currentTarget.classList.add("is-active")))}),document.addEventListener("mouseup",event=>{element.classList.contains("is-active")&&(element.classList.remove("is-active"),element.setAttribute("disable-update",!0),setTimeout(()=>{element.removeAttribute("disable-update")},300))})}),window.onerror=(msg,url,lineNo,columnNo,error)=>{let data=`Message: ${msg} \n ${url} (${lineNo}:${columnNo}) \n ${error?error.stack:""}`,formData=new FormData;formData.append("error",data),fetch(`${window.location.protocol}//${window.location.hostname}/app/error/frontend`,{method:"post",headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},credentials:"same-origin",body:formData}).then(response=>{response.ok||console.error("Error cannot be uploaded")})};let userActivities={interval:0,user:null,focus:1};const loginUser=user=>{sessionStorage.getItem("user")||(sessionStorage.setItem("user",user),userActivities.user=user)},logoutUser=()=>{sessionStorage.getItem("user")&&(sessionStorage.clear(),clearInterval(userActivities.interval),userActivities.user=null)},userActivity=()=>{checkActivity(),userActivities.interval=setInterval(checkActivity,6e4)},checkActivity=()=>{if(document.hasFocus()){if(sessionStorage.getItem("last-active")&&userActivities.focus){const now=moment(new Date),db=moment(new Date(sessionStorage.getItem("db-active"))),stored=moment(new Date(sessionStorage.getItem("last-active"))),time=parseFloat(sessionStorage.getItem("active-time"));now.diff(stored,"minute")<5?(sessionStorage.setItem("active-time",time+now.diff(stored,"second")/60),sessionStorage.setItem("last-active",now.format("YYYY-MM-DD HH:mm:ss")),now.diff(db,"minute")>=1&&sendActivity()):getActivity()}else getActivity();userActivities.focus=1}else userActivities.focus=0},getActivity=()=>{const user=sessionStorage.getItem("user");fetch(`${window.location.protocol}//${window.location.host}/app/users/${user}/activity`,{method:"get"}).then(response=>{if(response.ok)return response.json();console.error(response.status,response.statusText)}).then(data=>{const today=moment(new Date),before=moment(new Date(data.last_active));if(data.last_active&&today.diff(before,"minute")<5)sessionStorage.setItem("last-active",data.last_active),sessionStorage.setItem("db-active",data.last_active);else{const string=today.format("YYYY-MM-DD HH:mm:ss");sessionStorage.setItem("last-active",string)}sessionStorage.setItem("active-time",data.active_time)}).catch(error=>console.error(error))},sendActivity=()=>{const data=new FormData;data.append("last_active",sessionStorage.getItem("last-active")),data.append("active_time",Math.round(sessionStorage.getItem("active-time"))),data.append("_method","put");const user=sessionStorage.getItem("user");fetch(`${window.location.protocol}//${window.location.host}/app/users/${user}/activity`,{method:"post",headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},credentials:"same-origin",body:data}).then(response=>{if(response.ok)return response.json();console.error(response.status,response.statusText)}).then(data=>{data.error?console.error(data.message):sessionStorage.setItem("db-active",sessionStorage.getItem("last-active"))}).catch(error=>console.error(error))};document.addEventListener("click",event=>{let target=event.target;if(target.hasAttribute("data-is-delete")){const url=target.getAttribute("data-delete-url");ConfirmDeleteModal(url)}else if(target.parentNode.hasAttribute("data-is-delete")){target=target.parentNode;const url=target.getAttribute("data-delete-url");ConfirmDeleteModal(url)}if(target.hasAttribute("data-status-update")){const url=target.getAttribute("data-status-url"),status=target.getAttribute("data-status-update");ConfirmStatusModal(url,status)}else if(target.parentNode.hasAttribute("data-status-update")){target=target.parentNode;const url=target.getAttribute("data-status-url"),status=target.getAttribute("data-status-update");ConfirmStatusModal(url,status)}});const ChartsConstant={colors:{gray:{100:"#f6f9fc",200:"#e9ecef",300:"#dee2e6",400:"#ced4da",500:"#adb5bd",600:"#8898aa",700:"#525f7f",800:"#32325d",900:"#212529"},theme:{default:"#172b4d",primary:"#0087f8",secondary:"#f4f5f7",info:"#11cdef",success:"#2dce89",danger:"#f5365c",warning:"#fb6340"},black:"#12263F",white:"#FFFFFF",transparent:"transparent"},locale:"id",Callbacks:{ticks:(label,index,labels)=>new Intl.NumberFormat(ChartsConstant.locale,{maximumSignificantDigits:2}).format(label),tooltipsLabel:context=>{let label=context.dataset.label||"";return label&&(label+=" : "),null!==context.parsed.y&&(label+=new Intl.NumberFormat(ChartsConstant.locale,{maximumSignificantDigits:2}).format(context.parsed.y)),label},tooltipsDoughnut:context=>{let label=context.label||"";return label&&(label+=" : "),null!==context.parsed&&(label+=new Intl.NumberFormat(ChartsConstant.locale,{maximumSignificantDigits:2}).format(context.parsed)),label}}};function toastrs(title,message,status){toastr[status](message,title)}function arrayToJson(form){var data=$(form).serializeArray(),indexed_array={};return $.map(data,(function(n,i){indexed_array[n.name]=n.value})),indexed_array}function common_bind(selector="body"){var $datepicker=$(selector+" .datepicker");$(".datepicker").length&&$(".datepicker").daterangepicker({singleDatePicker:!0,format:"yyyy-mm-dd",locale:date_picker_locale}),$(".custom-datepicker").length&&$(".custom-datepicker").daterangepicker({singleDatePicker:!0,format:"Y-MM",locale:{format:"Y-MM"}})}function common_bind_select(selector="body"){jQuery().selectric&&$(".selectric").selectric({disableOnMobile:!1,nativeOnMobile:!1}).on("change",event=>{SelectricChangeCallbacks.forEach(callback=>{callback(event)})}),$(".jscolor").length&&jscolor.installByClassName("jscolor")}function common_bind_confirmation(){$("[data-confirm]").each((function(){var me=$(this),me_data=me.data("confirm");me_data=me_data.split("|"),me.fireModal({title:me_data[0],body:me_data[1],buttons:[{text:me.data("confirm-text-yes")||"Yes",class:"btn btn-danger btn-shadow",handler:function(){eval(me.data("confirm-yes"))}},{text:me.data("confirm-text-cancel")||"Cancel",class:"btn btn-secondary",handler:function(modal){$.destroyModal(modal),eval(me.data("confirm-no"))}}]})}))}function taskCheckbox(){var checked=0,count=0,percentage=0;count=$("#check-list input[type=checkbox]").length,checked=$("#check-list input[type=checkbox]:checked").length,percentage=parseInt(checked/count*100,10),isNaN(percentage)&&(percentage=0),$(".custom-label").text(percentage+"%"),$("#taskProgress").css("width",percentage+"%"),$("#taskProgress").removeClass("bg-warning"),$("#taskProgress").removeClass("bg-primary"),$("#taskProgress").removeClass("bg-success"),$("#taskProgress").removeClass("bg-danger"),percentage<=15?$("#taskProgress").addClass("bg-danger"):percentage>15&&percentage<=33?$("#taskProgress").addClass("bg-warning"):percentage>33&&percentage<=70?$("#taskProgress").addClass("bg-primary"):$("#taskProgress").addClass("bg-success")}window.Chart&&(Chart.defaults.font.family="'Poppins', 'Segoe UI', 'Arial'",Chart.defaults.font.size=11,Chart.defaults.font.weight="500",Chart.defaults.font.color="#999",Chart.defaults.responsive=!0,Chart.defaults.maintainAspectRatio=!1,Chart.defaults.scale.grid.borderDash=[2],Chart.defaults.scale.grid.borderDashOffset=[2],Chart.defaults.scale.grid.color=ChartsConstant.colors.gray[300],Chart.defaults.scale.grid.drawBorder=!1,Chart.defaults.scale.grid.drawTicks=!1,Chart.defaults.scale.grid.drawOnChartArea=!0,Chart.defaults.scale.beginsAtZero=!0,Chart.defaults.scale.ticks.padding=10,Chart.defaults.scale.ticks.callback=value=>{if(!(value%10))return value},Chart.defaults.interaction.intersect=!1,Chart.defaults.elements.line.tension=.4,Chart.defaults.elements.line.borderWidth=4,Chart.defaults.elements.line.borderCapStyle="rounded",Chart.defaults.plugins.legend.display=!1,Chart.defaults.plugins.tooltip.backgroundColor="#000",Chart.defaults.plugins.tooltip.titleFont={family:"'Poppins', 'Segoe UI', 'Arial'",color:"#fff",size:20,weight:"bold"},Chart.defaults.plugins.tooltip.padding=10,Chart.defaults.plugins.tooltip.cornerRadius=3),$((function(){$(".custom-scroll").niceScroll(),$(".custom-scroll-horizontal").niceScroll(),$(".activity-wrap").niceScroll()})),$(document).ready((function(){$("#float-btn").length&&$("#float-btn").on("click",()=>{$("#float-btn").toggleClass("open")}),$(".datepicker").length&&$(".datepicker").daterangepicker({singleDatePicker:!0,format:"yyyy-mm-dd",locale:date_picker_locale}),$(".datepicker-range").length&&$(".datepicker-range").daterangepicker({rangeDatePicker:!0,format:"yyyy-mm-dd",locale:date_picker_locale});let dataTables=document.querySelectorAll("table.dataTable");dataTables.length&&dataTables.forEach(table=>{table.classList.contains("no-paginate")||DataTable(table)}),dataTables=document.querySelector("#dataTable"),dataTables&&DataTable(dataTables)})),$(document).on("click",'a[data-ajax-popup="true"], button[data-ajax-popup="true"], div[data-ajax-popup="true"]',(function(){var title=$(this).data("title"),size=""==$(this).data("size")?"md":$(this).data("size"),url=$(this).data("url");$("#commonModal .modal-title").html(title),$("#commonModal .modal-dialog").addClass("modal-"+size),$.ajax({url:url,success:function(data){$("#commonModal .modal-body").html(data),$("#commonModal").modal("show"),taskCheckbox(),common_bind("#commonModal"),common_bind_select("#commonModal")},error:function(data){toastrs("Error",(data=data.responseJSON).error,"error")}})})),$(document).on("click",'a[data-ajax-popup-over="true"], button[data-ajax-popup-over="true"], div[data-ajax-popup-over="true"]',(function(){var validate=$(this).attr("data-validate"),id="";validate&&(id=$(validate).val());var title=$(this).data("title"),size=""==$(this).data("size")?"md":$(this).data("size"),url=$(this).data("url");$("#commonModalOver .modal-title").html(title),$("#commonModalOver .modal-dialog").addClass("modal-"+size),$.ajax({url:url+"?id="+id,success:function(data){$("#commonModalOver .modal-body").html(data),$("#commonModalOver").modal("show"),taskCheckbox()},error:function(data){toastrs("Error",(data=data.responseJSON).error,"error")}})})),$(document).on("submit","#commonModalOver form",(function(e){e.preventDefault();var data=arrayToJson($(this));data.ajax=!0;var url=$(this).attr("action");$.ajax({url:url,data:data,type:"POST",success:function(data){toastrs("Success",data.success,"success"),$(data.target).append('<option value="'+data.record.id+'">'+data.record.name+"</option>"),$(data.target).val(data.record.id),$(data.target).trigger("change"),$("#commonModalOver").modal("hide"),$(".selectric").selectric({disableOnMobile:!1,nativeOnMobile:!1})},error:function(data){toastrs("Error",(data=data.responseJSON).error,"error")}})})),function($,window,i){$.fn.fireModal=function(options){var options=$.extend({size:"modal-md",center:!1,animation:!0,title:"Modal Title",closeButton:!0,header:!0,bodyClass:"",footerClass:"",body:"",buttons:[],autoFocus:!0,created:function(){},appended:function(){},onFormSubmit:function(){},modal:{}},options);this.each((function(){var id="fire-modal-"+ ++i,trigger_class="trigger--"+id,trigger_button=$("."+trigger_class);$(this).addClass(trigger_class);let body=options.body;if("object"==typeof body)if(body.length){let part=body;body=body.removeAttr("id").clone().removeClass("modal-part"),part.remove()}else body='<div class="text-danger">Modal part element not found!</div>';var modal_template='   <div class="modal'+(1==options.animation?" fade":"")+'" tabindex="-1" role="dialog" id="'+id+'">       <div class="modal-dialog '+options.size+(options.center?" modal-dialog-centered":"")+'" role="document">         <div class="modal-content">  '+(1==options.header?'         <div class="modal-header">             <h5 class="modal-title">'+options.title+"</h5>  "+(1==options.closeButton?'           <button type="button" class="close" data-dismiss="modal" aria-label="Close">               <span aria-hidden="true">&times;</span>             </button>  ':"")+"         </div>  ":"")+'         <div class="modal-body">           </div>  '+(options.buttons.length>0?'         <div class="modal-footer">           </div>  ':"")+"       </div>       </div>    </div>  ",modal_template=$(modal_template),this_button;options.buttons.forEach((function(item){let id="id"in item?item.id:"";this_button='<button type="'+("submit"in item&&1==item.submit?"submit":"button")+'" class="'+item.class+'" id="'+id+'">'+item.text+"</button>",this_button=$(this_button).off("click").on("click",(function(){item.handler.call(this,modal_template)})),$(modal_template).find(".modal-footer").append(this_button)})),$(modal_template).find(".modal-body").append(body),options.bodyClass&&$(modal_template).find(".modal-body").addClass(options.bodyClass),options.footerClass&&$(modal_template).find(".modal-footer").addClass(options.footerClass),options.created.call(this,modal_template,options);let modal_form=$(modal_template).find(".modal-body form"),form_submit_btn=modal_template.find("button[type=submit]");if($("body").append(modal_template),options.appended.call(this,$("#"+id),modal_form,options),modal_form.length){options.autoFocus&&$(modal_template).on("shown.bs.modal",(function(){"boolean"==typeof options.autoFocus?modal_form.find("input:eq(0)").focus():"string"==typeof options.autoFocus&&modal_form.find(options.autoFocus).length&&modal_form.find(options.autoFocus).focus()}));let form_object={startProgress:function(){modal_template.addClass("modal-progress")},stopProgress:function(){modal_template.removeClass("modal-progress")}};modal_form.find("button").length||$(modal_form).append('<button class="d-none" id="'+id+'-submit"></button>'),form_submit_btn.on("click",(function(){modal_form.submit()})),modal_form.submit((function(e){form_object.startProgress(),options.onFormSubmit.call(this,modal_template,e,form_object)}))}$(document).on("click","."+trigger_class,(function(){return $("#"+id).modal(options.modal),!1}))}))},$.destroyModal=function(modal){modal.modal("hide"),modal.on("hidden.bs.modal",(function(){}))}}(jQuery,this,0);